<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/shinytutorials/styles.04cea1a461dec28a05fb.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2b2b2b}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#d4d0ab}.token.punctuation{color:#fefefe}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ffa07a}.token.boolean,.token.number{color:#00e0e0}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#abe338}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#00e0e0}.token.atrule,.token.attr-value,.token.function{color:gold}.token.keyword{color:#00e0e0}.token.important,.token.regex{color:gold}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media screen and (-ms-high-contrast:active){code[class*=language-],pre[class*=language-]{color:windowText;background:window}:not(pre)>code[class*=language-],pre[class*=language-]{background:window}.token.important{background:highlight;color:window;font-weight:400}.token.atrule,.token.attr-value,.token.function,.token.keyword,.token.operator,.token.selector{font-weight:700}.token.attr-value,.token.comment,.token.doctype,.token.function,.token.keyword,.token.operator,.token.property,.token.string{color:highlight}.token.attr-value,.token.url{font-weight:400}}@font-face{font-family:Open Sans;font-style:normal;font-weight:400;src:url(/shinytutorials/static/open-sans-v17-latin-regular-5f4d4bc11d64b6cb605b7030c1997270.eot);src:local("Open Sans Regular"),local("OpenSans-Regular"),url(/shinytutorials/static/open-sans-v17-latin-regular-5f4d4bc11d64b6cb605b7030c1997270.eot?#iefix) format("embedded-opentype"),url(/shinytutorials/static/open-sans-v17-latin-regular-33543c5cc5d88f5695dd08c87d280dfd.woff2) format("woff2"),url(/shinytutorials/static/open-sans-v17-latin-regular-de0869e324680c99efa1250515b4b41c.woff) format("woff"),url(/shinytutorials/static/open-sans-v17-latin-regular-049a929c5d81988b3ae6d2f985ca7aa5.ttf) format("truetype"),url(/shinytutorials/static/open-sans-v17-latin-regular-7aab4c13671282c90669eb6a10357e41.svg#OpenSans) format("svg")}@font-face{font-family:Open Sans;font-style:normal;font-weight:600;src:url(/shinytutorials/static/open-sans-v17-latin-600-ddacaf4a9db58cda27c76ce88c408546.eot);src:local("Open Sans SemiBold"),local("OpenSans-SemiBold"),url(/shinytutorials/static/open-sans-v17-latin-600-ddacaf4a9db58cda27c76ce88c408546.eot?#iefix) format("embedded-opentype"),url(/shinytutorials/static/open-sans-v17-latin-600-819af3d3abdc9f135d49b80a91e2ff4c.woff2) format("woff2"),url(/shinytutorials/static/open-sans-v17-latin-600-449d681cd6006390e1bee3c3a660430b.woff) format("woff"),url(/shinytutorials/static/open-sans-v17-latin-600-8f7128145a3c2b83923552a328df7cdc.ttf) format("truetype"),url(/shinytutorials/static/open-sans-v17-latin-600-e16f375be3c2a73b58255a02f6d3a9ce.svg#OpenSans) format("svg")}body,html{padding:0;margin:0;font-family:Open Sans,Helvetica,sans-serif;cursor:default;font-size:15pt}article,aside,footer,header,main,nav{padding:0;margin:0;display:block}h1,h2,h3,h4,h5,h6{display:block;color:#2a2c32;line-height:1.3;padding:0;margin:0 0 6px}p{color:#3f454b;line-height:1.6;padding:0;margin:0 0 12px}li li,ol li{margin:0;padding:0;line-height:1.7}li li p,ol li p{padding:0;margin:0;line-height:1}li li a,ol li a{padding:0;margin:0;line-height:1.5}li li ol,ol li ol{list-style-type:lower-alpha}li{color:#3f454b;line-height:1.3}a{color:#5177b8;text-decoration:none;box-shadow:0 1px 0 #5177b8}blockquote{line-height:1.3}input{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:90%;font-size:12pt;padding:8px 8px 8px 12px;border-radius:0;border:none;background-color:#f6f6f6;box-shadow:inset 0 2px 2px #d8d8d8}img,input{display:block}img{width:100%}:not(pre)>code{font-size:14pt}.icon{display:inline-block;width:20px;height:20px}.gatsby-highlight{font-size:12pt;overflow:auto}.gatsby-highlight pre{border-radius:4px}.gatsby-resp-image-link{box-shadow:none}button{display:block;border:none;background:none;cursor:pointer}.btn,.btn-link{display:block;padding:4px;margin:8px 0;font-size:14px;background-color:transparent;border-left:3px solid transparent;text-align:center}.btn-primary,.btn-secondary{text-transform:uppercase;letter-spacing:2px;font-weight:600;border-radius:3px;padding:6px 12px}.btn-primary{background-color:#5177b8;border:2px solid #5177b8;color:#fff;padding:8px 12px}.btn-primary:focus,.btn-primary:hover{background-color:transparent;border-color:#5177b8;color:#5177b8}.btn-secondary{background-color:transparent;border:2px solid #5177b8;color:#5177b8}.btn-secondary:focus,.btn-secondary:hover{background-color:#5177b8;color:#f6f6f6;border-color:#5177b8}.btn-keyword{font-size:12pt}.btn-keyword.selected,.btn-keyword:focus,.btn-keyword:hover{color:#5177b8;font-weight:600;border-left-color:#5177b8}.btn-centered{width:100px;margin:24px auto 0}.nav{position:fixed;top:0;left:0;width:100%;padding:6px 0;display:-ms-grid;display:grid;grid-template-columns:65% 35%;grid-template-areas:"brandLink menuBtn";-webkit-column-gap:0;column-gap:0;row-gap:0;background-color:#fff;box-shadow:0 2px 6px rgba(0,0,0,.18);z-index:15}.nav .nav-item{display:flex;align-items:center}.nav .nav-item.brand-link{grid-area:brandLink;color:#5177b8;font-weight:600;font-size:14pt;letter-spacing:2px;padding:0 0 0 16px;box-shadow:none}.nav .nav-item.brand-link .brand-link-icon path{fill:#5177b8}.nav .navigation{display:block;position:absolute;top:48px;width:1px;height:1px;clip:rect(0 0 0 0);clip:rect(0,0,0,0);padding:32px 0;background-color:#fff;z-index:14}.nav .navigation .menu-item{display:block;text-align:center}.nav .navigation .menu-item .menu-link{font-size:16pt;box-shadow:none}.nav .navigation.expanded{width:100%;height:auto;clip:auto;box-shadow:0 6px 6px rgba(0,0,0,.18)}.nav .menu-btns{justify-content:flex-end;grid-area:menuBtn}.nav .menu-btns .menu-button{margin:0}.nav .menu-btns .menu-button #menuBtn{margin-right:16px}@media screen and (min-width:972px){.nav{display:grid;grid-template-areas:"brandLink navLinks";grid-template-columns:200px 80%}.nav .nav-item.brand-link{padding-bottom:0;grid-area:brandLink}.nav .nav-item.navigation{position:static;display:flex;width:100%;grid-area:navLinks;box-shadow:none}.nav .nav-item.navigation .menu-item{display:inline-block;width:auto;margin:0 24px 0 0}.nav .nav-item.navigation .menu-item .menu-link{font-size:11pt}.nav .nav-item.navigation .menu-item:last-child{margin-right:0}.nav .nav-item.menu-btns{display:none}}.menu{width:100%;margin:0 auto;list-style:none;padding:6px 0}.menu .menu-item{display:block;padding:0;margin:0 0 12px}.menu .menu-item .menu-link{position:relative;text-transform:uppercase;font-size:11pt;letter-spacing:2px;font-weight:600;color:#5177b8;padding-bottom:4px;border-bottom:2px solid transparent}.menu .menu-item .menu-link .menu-link-icon{position:relative;padding-right:6px;top:4px}.menu .menu-item .menu-link .menu-link-icon path{fill:#5177b8}.menu .menu-item .menu-link:hover{border-bottom-color:#5177b8}@media screen and (min-width:972px){.menu .menu-item{display:inline-block;margin:0 18px 0 0}}.footer{margin:0;padding:62px 0;background-color:#2a2c32}.footer h2{display:block;width:85%;margin:0 auto;padding-top:12px;color:#d8d8d8;letter-spacing:2.5px}.footer .menu{list-style:none;width:85%;margin:12px auto;padding:0}.footer .menu .menu-item{margin-right:24px}.footer .menu .menu-item .menu-link{color:#d8d8d8;box-shadow:none}.footer .menu .menu-item .menu-link .menu-link-icon path{fill:#d8d8d8}.footer .menu .menu-item .menu-link:hover{border-bottom-color:#d8d8d8}.post{padding:32px;border-radius:6px}.post .post-image{background-position:50%;background-size:cover;margin-bottom:12px}.post .post-title{margin:0;padding:0}.post .post-title-link a{color:#2a2c32;box-shadow:0 1px 0 #3f454b}.post .post-desc{padding:0;margin:0;width:100%}.post .post-date{display:inline-block;color:#3f454b;font-size:11pt;font-family:consolas,courier,sans-serif;margin-right:12px}.post .post-tags{display:block;padding:0;margin:0 0 16px;list-style:none;color:#3f454b}.post .post-tags li{display:inline-block;margin-right:12px}.post .post-tags li .tag{border-radius:6px;font-size:11pt;padding:5px 10px;background-color:#f6f6f6;font-family:consolas,courier,sans-serif}.post .post-tags li .tag:before{content:"#"}.post .post-tags li:first-child{margin-left:0}.post .post-link{display:block;text-align:center;text-transform:uppercase;font-size:12pt;letter-spacing:2px;text-decoration:none;border-radius:4px;padding:6px 0;font-weight:600;box-shadow:none}.post .post-link:hover{text-decoration:underline}.post.post-feature{margin:16px auto;background-color:#fff}.post.post-feature .post-link{margin:0 auto;border:1px solid #5177b8;background-color:#5177b8;color:#fff}.post.post-plain{background-color:#fff;margin-bottom:16px}.post.post-plain .post-link{border:1px solid #5177b8}.post.post-plain .post-link:hover{background-color:#5177b8;color:#fff}.post-form{padding:32px;border-radius:0 0 6px;background-color:#fff;border-top:4px solid #5177b8;margin-bottom:16px}.post-form .input-label{display:block;padding:0;margin:0;font-size:18pt;color:#3f454b;font-weight:600}.post-form .input-example{line-height:1.5;padding:0;font-size:12pt;color:#3f454b;margin:0 0 12px}@media screen and (min-width:972px){.post{max-width:872px}.post.post-plain .post-link,.post.post-plain .post-tags{display:inline-flex;justify-content:center;align-items:center}.post.post-plain .post-link{width:125px;float:right}.post-form{max-width:872px}}.hero{width:100%;padding:44px 0;display:flex;position:relative;justify-content:center;align-items:center;background-color:#fff;overflow:hidden}.hero.hero-index .hero-content{width:90%;margin:0 auto;padding:72px 0;z-index:2}.hero.hero-index .hero-content .hero-title{font-size:21pt;letter-spacing:2.5px}.hero.hero-index .hero-content .hero-subtitle{font-weight:600;font-size:32pt;letter-spacing:2px;line-height:1.2}.hero.hero-index .hero-content .hero-image{display:block;width:300px;margin:44px auto;box-shadow:0 12px 3px -6px rgba(0,0,0,.18)}.hero.hero-text .hero-content{width:90%;margin:0 auto;padding:82px 0 0}.hero.hero-text .hero-content p{margin:0}.hero.hero-style-1{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxNDQwcHgiIGhlaWdodD0iNjcxcHgiIHZpZXdCb3g9IjAgMCAxNDQwIDY3MSIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48IS0tR2VuZXJhdG9yOiBTa2V0Y2ggNTkuMSAoODYxNDQpIC0gaHR0cHM6Ly9za2V0Y2guY29tLS0+PHRpdGxlPmhlcm8tYmstZ3JheTwvdGl0bGU+PGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+PGcgaWQ9IkJhY2tncm91bmRzIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48ZyBpZD0iaGVyby1iay1ncmF5LWNvcHkiIGZpbGw9IiM1MTc3YjgiIGZpbGwtb3BhY2l0eT0iMC4zIj48cGF0aCBkPSJNLTEuMjk5NjU0ODNlLTE0LDAgTDE0NDAsMCBDMTQ0MCw5NS45MTQ2OTE5IDE0NDAsMTg1Ljk3MzIwOCAxNDQwLDI3MC4xNzU1NDcgQzE0NDAsMzU0LjM3Nzg4NyAxNDQwLDQ3OS4zMTkzNzEgMTQ0MCw2NDUgQzEyODYuMzEwNjIsNTg3Ljc4MzUyNiAxMTI0LjkxNjc3LDU1MS45MDgyNTQgOTU1LjgxODQ0NSw1MzcuMzc0MTgzIEM3MDIuMTcwOTU5LDUxNS41NzMwNzYgNDU2Ljc1MDAwNiw3NDYuNzg4NDcxIDIxNi4yNzE0MTEsNjQ1IEM3MS41NDI5NDAxLDU4My43NDAxMjEgMC45MjI0ODU1MDIsNTA2LjI2ODcxIDEuMDM5NTg1MDhlLTEzLDQxMS42MzcxNzIgQy0wLjA2NjI0ODYzNzQsNDA0Ljg0MTE3MyAtMC4wNjYyNDg2Mzc0LDM5NC4yOTU0NDkgLTEuNTgxMzczOTJlLTE0LDM4MCBMLTEuMjk5NjU0ODNlLTE0LDAgWiIgaWQ9Imhlcm8tYmstZ3JheSIvPjwvZz48L2c+PC9zdmc+);background-size:cover;background-position:50% 100%;background-repeat:no-repeat}@media screen and (min-width:972px){.hero.hero-index .hero-content,.hero.hero-text .hero-content{width:100%;max-width:912px}.hero.hero-index .hero-content .hero-image,.hero.hero-text .hero-content .hero-image{transform:scale(1.25)}}.flex{display:flex}.flex .flex-child{display:block;width:100%;height:auto}.flex.flex-30x70-layout,.flex.flex-33x3-layout,.flex.flex-50x2-layout{width:100%;flex-wrap:wrap}@media (min-width:812px){.flex.flex-30x70-layout .flex-child{display:inline-block}.flex.flex-30x70-layout .flex-child:nth-child(odd){width:30%}.flex.flex-30x70-layout .flex-child:nth-child(2n){width:70%}.flex.flex-33x3-layout .flex-child{display:inline-block;width:33%}.flex.flex-50x2-layout .flex-child{display:inline-block}.flex.flex-50x2-layout .flex-child:nth-child(2n),.flex.flex-50x2-layout .flex-child:nth-child(odd){width:50%}}.article-profile{display:inline-flex;justify-content:center;align-items:center;margin-top:12px}.article-profile .profile-img{width:40px;border-radius:50%}.article-profile .profile-name{font-size:12pt;margin-left:6px;color:#3f454b}.article-hero{padding-bottom:0}.article-hero h1{font-size:13pt;text-transform:uppercase;letter-spacing:2px}.article-hero h2{font-size:28pt}.article-hero .article-dates,.article-hero .article-readtime{margin:0;line-height:1.5;font-size:11pt;text-transform:uppercase;letter-spacing:2px;padding:0}.article-hero .article-dates time,.article-hero .article-readtime time{font-weight:400}.article-hero .article-readtime{color:#5177b8}.article{width:100%;padding:32px 0;border-radius:6px;background-color:#fff}.article .article-abstract,.article .article-body,.article .article-footer,.article .article-title{display:block;width:90%;margin:0 auto}.article .article-title{text-align:center}.article .article-abstract{color:#3f454b;line-height:1.6}.article .article-abstract :not(h2){color:#3f454b}.article .article-body h2{padding:0;margin:24px 0 0}.article .article-body a{color:#5177b8}.article .article-body blockquote{background-color:#f6f6f6;padding:2px 12px;margin:44px 0;border-left:10px solid #5177b8}.article .article-footer{border-top:1px solid #a3a6a8;margin-top:12px;padding-top:12px}.article .article-footer .article-tags{display:inline-block;padding:0;margin:0;list-style:none;color:#3f454b}.article .article-footer .article-tags li{display:inline-block;margin-right:12px}.article .article-footer .article-tags li .tag{border-radius:6px;font-size:11pt;padding:5px 10px;background-color:#f6f6f6;font-family:consolas,courier,sans-serif}.article .article-footer .article-tags li .tag:before{content:"#"}.article .article-footer .article-tags li:first-child{margin-left:0}.article-toc h2{font-size:21pt}.article-toc ol,.article-toc ul{font-size:13pt}.article-toc ol li,.article-toc ul li{margin-bottom:12px}.article-toc ol li ol,.article-toc ol li ul,.article-toc ul li ol,.article-toc ul li ul{margin-top:12px}.article-toc ol li ol li,.article-toc ol li ul li,.article-toc ul li ol li,.article-toc ul li ul li{margin-bottom:6px}.article-toc ol li:last-child,.article-toc ol li ol li:last-child,.article-toc ol li ul li:last-child,.article-toc ul li:last-child,.article-toc ul li ol li:last-child,.article-toc ul li ul li:last-child{margin-bottom:0}.article-toc ol a,.article-toc ul a{box-shadow:none}.article-toc ol a :focus,.article-toc ol a:hover,.article-toc ul a :focus,.article-toc ul a:hover{box-shadow:0 2px 0 0 #5177b8}@media (min-width:972px){.article{max-width:812px}}.main{padding:0;min-height:60vh}.main .full-section{width:100%}.main .full-section .full-section-content,.main .main-section{width:90%;margin:0 auto}.main .main-section{padding:24px 0}.main .filled-section{padding:44px 0}.main .filled-section:not(.welcome-section){background-color:#f6f6f6}.main .filled-section:not(.welcome-section) p:not(.post-desc){text-align:center}.main .filled-section h2{text-align:center;text-transform:uppercase;letter-spacing:2px;padding:0;margin:0}.main .filled-section:last-child{margin-bottom:0}.main .filled-section.welcome-section p{max-width:812px;margin:0 auto}@media (min-width:972px){.main .full-section .full-section-content,.main .main-section{max-width:972px}}.sidebar-layout{display:flex;width:100%;flex-wrap:wrap}.sidebar-layout .sidebar-panel{position:static;padding-top:50px}.sidebar-layout .sidebar-panel .sidebar-content{background-color:#fff;margin:0 auto;padding:32px;border-radius:6px}.sidebar-layout .sidebar-panel .sidebar-content .sidebar-title{display:block;width:100%}.sidebar-layout .sidebar-panel .sidebar-content .sidebar-title .sidebar-toggle{position:relative;margin:0;padding:0;font-size:18pt}.sidebar-layout .sidebar-panel .sidebar-content .sidebar-title .sidebar-toggle .sidebar-toggle-icon{position:absolute;top:4px;margin-left:12px;transform:rotate(-45deg);transform-origin:center center;transition:all .3s ease-in-out}.sidebar-layout .sidebar-panel .sidebar-content .sidebar-title .sidebar-toggle .sidebar-toggle-icon circle{fill:#f6f6f6}.sidebar-layout .sidebar-panel .sidebar-content .sidebar-title .sidebar-toggle .sidebar-toggle-icon line{stroke:#5177b8}.sidebar-layout .sidebar-panel .sidebar-content .sidebar-title .sidebar-toggle .sidebar-toggle-icon.rotated{transform:rotate(0)}.sidebar-layout .sidebar-panel .sidebar-content .sidebar-caption{margin:0 0 12px;line-height:1.3;font-size:14pt}.sidebar-layout .sidebar-panel .sidebar-content .taglist{list-style:none;padding:0;margin:0 0 16px -6px}.sidebar-layout .sidebar-panel .sidebar-content .taglist .taglist-item{width:200px;padding:0 24px 0 0;margin-bottom:12px;cursor:pointer}.sidebar-layout .sidebar-panel .sidebar-content.expanded{position:absolute;width:1px;height:1px;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);overflow:hidden}.sidebar-layout .main-panel{padding-top:50px}.sidebar-layout .main-panel,.sidebar-layout .sidebar-panel{width:90%;margin:0 auto}@media (min-width:972px){.sidebar-layout .sidebar-panel{width:30%;margin:0 auto;position:-webkit-sticky;position:sticky;top:62px;height:100%}.sidebar-layout .main-panel,.sidebar-layout .sidebar-panel .sidebar-content{width:70%}}#menuBtn{display:flex;justify-content:center;align-items:center;background-color:transparent}#menuBtn .menu-icon{display:block;margin:0 auto;position:relative}#menuBtn .menu-icon .menu-bar{display:block;height:3px;width:30px;border-radius:6px;margin-bottom:6px;background-color:#5177b8;transition:all .2s ease-in-out}#menuBtn .menu-icon .menu-bar:first-child{margin-top:2px}#menuBtn.open .menu-bar:first-child{opacity:0}#menuBtn.open .menu-bar:nth-child(2){transform:rotate(-45deg);transform-origin:center .5px;background-color:#5177b8}#menuBtn.open .menu-bar:nth-child(3){transform:rotate(45deg);transform-origin:24.85px -2.5px;background-color:#5177b8}#menuBtn.open .menu-label{color:#5177b8}.article table,.datatable{width:100%;margin:8px auto 6px;font-weight:400;border-spacing:0;text-align:left;font-size:13pt}.article table caption,.datatable caption{text-align:left;font-size:16pt;margin:12px 0;color:#2a2c32;font-weight:600}.article table thead tr th,.datatable thead tr th{font-weight:600;padding:4px 12px;border-bottom:1px solid #2a2c32;color:#2a2c32}.article table tbody tr td,.datatable tbody tr td{padding:24px 12px}.article table tbody tr td .hidden-colname,.datatable tbody tr td .hidden-colname{display:none}.article table tbody tr:nth-child(2n),.datatable tbody tr:nth-child(2n){background-color:#f6f6f6}@media (max-width:892px){.datatable thead{display:none}.datatable tbody tr{display:block;margin-bottom:16px;counter-increment:rowCounter}.datatable tbody tr:nth-child(2n){background-color:transparent}.datatable tbody tr td{display:block;padding:6px 0 6px 6px;color:#3f454b}.datatable tbody tr td:first-child{font-size:16pt;color:#2a2c32}.datatable tbody tr td:first-child:before{content:counter(rowCounter) ".";display:inline-block;margin-right:4px;font-size:15pt}.datatable tbody tr td:not(:first-child){border-bottom:1px solid #f6f6f6}.datatable tbody tr td .hidden-colname{display:inline-block;width:150px}.datatable tbody tr td .hidden-colname:after{content:":"}}.visually-hidden{position:absolute;width:1px;height:1px;clip:rect(0 0 0 0);clip:rect(0,0,0,0);overflow:hidden}.tutorial-index{padding:0 0 66px;background-color:#f6f6f6}.tutorial-index .tutorial-index-posts{padding:32px 0}.tutorial-index .tutorial-index-posts h2{padding-left:32px;margin-bottom:32px}.tutorial{padding:0 0 50px;background-color:#f6f6f6}.about-page #repos .column-4,.about-page #repos .column-5,.about-page #repos .column-6,.about-page #repos thead th:nth-child(n+4){text-align:left}@media (min-width:972px){.related-projects .post.post-feature,.tutorial-latest .post.post-feature{max-width:40%}.related-projects .post.post-feature:nth-child(odd),.tutorial-latest .post.post-feature:nth-child(odd){margin-right:32px}.tutorial-index .tutorial-index-posts{padding-top:82px}.about-page #repos .column-4,.about-page #repos .column-5,.about-page #repos .column-6,.about-page #repos thead th:nth-child(n+4){text-align:right}.gallery-page .post .post-link{width:250px}}</style><meta name="generator" content="Gatsby 2.20.10"/><title data-react-helmet="true">shinyTutorials | Leaflet Busy Element</title><meta data-react-helmet="true" name="description" content="Leaflet Busy Element Create a custom loading element for leaflet maps"/><meta data-react-helmet="true" property="og:title" content="Leaflet Busy Element"/><meta data-react-helmet="true" property="og:description" content="Leaflet Busy Element Create a custom loading element for leaflet maps"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="dcruvolo"/><meta data-react-helmet="true" name="twitter:title" content="Leaflet Busy Element"/><meta data-react-helmet="true" name="twitter:description" content="Leaflet Busy Element Create a custom loading element for leaflet maps"/><meta data-react-helmet="true" name="keywords" content="htmlwidgets, leaflet"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="shinytutorials latest posts" href="/shinytutorials/rss.xml"/><link as="script" rel="preload" href="/shinytutorials/webpack-runtime-2f0160c733efec14b8a6.js"/><link as="script" rel="preload" href="/shinytutorials/framework-e94c62ba7ecbd1156bac.js"/><link as="script" rel="preload" href="/shinytutorials/app-861713a6e6d99061f672.js"/><link as="script" rel="preload" href="/shinytutorials/styles-36681512479a843831b0.js"/><link as="script" rel="preload" href="/shinytutorials/commons-c531f5118f02e9104877.js"/><link as="script" rel="preload" href="/shinytutorials/ec800322c0f71b5715d75b0073f476a066af1f45-5dfcbcfd5bde2ac1f549.js"/><link as="script" rel="preload" href="/shinytutorials/component---src-components-tutorials-js-d53ebef395d5c90dcd9c.js"/><link as="fetch" rel="preload" href="/shinytutorials/page-data/tutorials/leaflet-loading-screens/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/shinytutorials/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="nav" role="navigation"><a class="nav-item brand-link" href="/shinytutorials/">shinyTutorials</a><ul class="menu nav-item navigation"></ul><ul class="nav-item menu menu-btns" aria-label="site settings"><li class="menu-item menu-button"><button id="menuBtn" class="" aria-expanded="false"><span class="menu-icon" aria-hidden="true"><span class="menu-bar"></span><span class="menu-bar"></span><span class="menu-bar"></span></span></button></li></ul></nav><header class="hero hero-index article-hero"><div class="hero-content"><h1 class="hero-title"></h1><h2 class="hero-subtitle"></h2><h1>Leaflet Busy Element</h1><h2>Create a custom loading element for leaflet maps</h2><p class="article-dates">Published: <time>2020-04-02</time></p><p class="article-dates">Updated: <time>2020-04-23</time></p><p class="article-readtime"><time>14</time> minute read</p><div class="article-profile"><img class="profile-img" src="/shinytutorials/static/dcruvolo-16a2e1e5e48ba95aed1c754fd7fd0d57.jpeg" alt="@dcruvolo"/><span class="profile-name">@dcruvolo</span></div></div></header><main id="main" class="main tutorial" aria-label="main content"><div class="sidebar-layout"><aside class="sidebar-panel article-toc"><section class="sidebar-content"><div><h2>Contents</h2>
<ol>
<li><a href="#about">Why would I need this?</a></li>
<li>
<p><a href="#work">How does this app work?</a></p>
<ul>
<li><a href="#work-new-app">Creating the structure of the shiny app</a></li>
<li><a href="#work-ui-html">Writing the HTML markup for the loading UI</a></li>
<li><a href="#work-ui-css">Styling the loading UI</a></li>
<li><a href="#work-ui-js">Writing javascript to control the loading UI</a></li>
</ul>
</li>
<li><a href="#know">What do I need to know before I integrate this into my app?</a></li>
<li><a href="#run">How do I run the example?</a></li>
</ol>
</div></section></aside><div class="main-panel tutorial-body"><article class="article"><section class="article-abstract"><h2>Overview</h2>The leaflet package in R is great package for creating interactive maps in shiny. However, if you are using larger datasets or running a lot of server-side jobs, it may take some time for the leaflet map to render and update. Displaying progress indicators can improve the user experience by reassuring the user when something is happening and how long it might last.</section><section class="article-body">
<span id="about" />
<h2>Why would I need this?</h2>
<p>The leaflet package in R is great package for creating interactive maps in shiny. However, if you are using larger datasets or running a lot of server-side jobs, it may take some time for the leaflet map to render and update. This may result in a poor user experience as the user will have to wait for some time until they can view the data or perform additional actions. It is possible to alleviate some of the waiting by rewriting reactive events to observe events, but sometimes that is not enough. Displaying progress indicators can improve the user experience by reassuring the user when something is happening and how long it might last. </p>
<p>A quick side note: the 99% Invisible episode <a href="https://99percentinvisible.org/episode/wait-wait-tell-me/">Wait Wait...Tell me!</a> provides a fascinating overview on the history of waiting and user interfaces.</p>
<p>There are some fantastic R packages for creating wait messages in shiny (e.g., <a href="https://github.com/JohnCoene/waiter">waitr</a>, <a href="https://github.com/JohnCoene/waiter">shinycustomloader</a>, etc.), but it is a bit tricky to add to work with leaflet. Instead, with a little bit of html, css, ans javascript, we can create our own. This tutorial provides instructions for creating a loading screen for leaflet outputs. Specifically, the example application will demonstrate how to -</p>
<ol>
<li>Display a loading screen during the intitial rendering of a leaflet map, and to</li>
<li>Show the loading screen when a button is clicked and to remain visible until server-side processing is complete</li>
</ol>
<p>The app was originally written for this R community post: <a href="https://community.rstudio.com/t/show-leaflet-spinner-when-rendering-slow-leaflet-map-in-shiny/57896">Show leaflet spinner when rendering slow leaflet map in shiny</a>.</p>
<blockquote>
<p>This tutorial focuses on javascript. Some experience will definitely help, but it is not required. I've tried to keep concepts simple and reference outside sources where possible. If you have suggestions for improvement or notice any errors, feel free to open a new <a href="https://github.com/davidruvolo51/shinytutorials/issues">issue</a>.</p>
</blockquote>
<span id="work" />
<h2>How does this app work?</h2>
<p>To get the app up and running, we need to complete a few things. In this section, I will cover the following items.</p>
<ol>
<li>Creating the structure of the shiny app</li>
<li>Writing the HTML markup for the loading UI</li>
<li>Styling the loading UI</li>
<li>Writing javascript to control the loading UI </li>
</ol>
<span id="work-new-app" />
<h3>Creating the structure of the shiny app</h3>
<p>Let's start off by setting up our project and creating the files. Create a new directory and an R project. Open the R project and then create the following.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token comment"># in the console</span>
file.create<span class="token punctuation">(</span><span class="token string">"app.R"</span><span class="token punctuation">)</span>
file.create<span class="token punctuation">(</span><span class="token string">"leaflet_loader.R"</span><span class="token punctuation">)</span>
dir.create<span class="token punctuation">(</span><span class="token string">"www"</span><span class="token punctuation">)</span>
file.create<span class="token punctuation">(</span><span class="token string">"www/styles.css"</span><span class="token punctuation">)</span></code></pre></div>
<p>In this example, I'm using the single <code>app.R</code> approach. I created a separate R file for the loading UI component and save all corresponding styles in a css file (located in the <code>www/</code> directory).</p>
<p>I'm using the <a href="https://shiny.rstudio.com/articles/html-tags.html">tags</a> approach for the UI. <code>tags$link</code> is used to load the stylesheet. I'm wrapping everything in the <code>main</code> element. In the original post, the user wanted to show the loading UI when a button is clicked. I added an button and assigned the appropriate classes to register the element with shiny. I left some blank space for now. This space will be used for the leaflet loader, which will be discussed in a little bit.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token comment"># ui</span>
ui <span class="token operator">&lt;-</span> tagList<span class="token punctuation">(</span>
    tags<span class="token operator">$</span>head<span class="token punctuation">(</span>
        tags<span class="token operator">$</span>link<span class="token punctuation">(</span>
            rel <span class="token operator">=</span> <span class="token string">"stylesheet"</span><span class="token punctuation">,</span>
            href <span class="token operator">=</span> <span class="token string">"styles.css"</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span> 
    tags<span class="token operator">$</span>main<span class="token punctuation">(</span>
        tags<span class="token operator">$</span>h2<span class="token punctuation">(</span><span class="token string">"Map Output"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        tags<span class="token operator">$</span>button<span class="token punctuation">(</span>
            id <span class="token operator">=</span> <span class="token string">"plotbutton"</span><span class="token punctuation">,</span>
            class <span class="token operator">=</span> <span class="token string">"action-button shiny-bound-input"</span><span class="token punctuation">,</span>
            <span class="token string">"Add Markers"</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment"># loading ui</span>
        <span class="token ellipsis">...</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>In the server, I created a basic leaflet map using the example provided in the R leaflet's <a href="https://github.com/rstudio/leaflet/blob/master/README.md">README</a> (accessed on 2020-04-02). Using the <a href="https://community.rstudio.com/t/show-leaflet-spinner-when-rendering-slow-leaflet-map-in-shiny/57896/10">example</a> provided in the R community post, I added an event that adds random markers around a coordinate set when a button is clicked.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token comment"># server</span>
server <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> output<span class="token punctuation">,</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># render map</span>
    output<span class="token operator">$</span>map <span class="token operator">&lt;-</span> renderLeaflet<span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment"># simulate building</span>
        <span class="token comment"># build map</span>
        leaflet<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%>%</span>
            addTiles<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%>%</span>
            setView<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">93.65</span><span class="token punctuation">,</span> <span class="token number">42.0285</span><span class="token punctuation">,</span> zoom <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%>%</span>
            addPopups<span class="token punctuation">(</span>
                lng <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">93.65</span><span class="token punctuation">,</span>
                lat <span class="token operator">=</span> <span class="token number">42.0285</span><span class="token punctuation">,</span>
                popup <span class="token operator">=</span> <span class="token string">"Here is the &lt;b>Department of Statistics&lt;/b>, ISU"</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment"># add points on render</span>
    observeEvent<span class="token punctuation">(</span>input<span class="token operator">$</span>plotbutton<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        dlat <span class="token operator">&lt;-</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">111000</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token comment"># degrees per metre</span>
        n <span class="token operator">&lt;-</span> <span class="token number">100</span>
        leafletProxy<span class="token punctuation">(</span><span class="token string">"map"</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%>%</span>
            addMarkers<span class="token punctuation">(</span>
                lng <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">93.65</span> <span class="token operator">+</span> <span class="token punctuation">(</span>runif<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> dlat <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span>
                lat <span class="token operator">=</span> <span class="token number">42.0285</span> <span class="token operator">+</span> <span class="token punctuation">(</span>runif<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> dlat
            <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now, let's focus on the loading UI.</p>
<span id="work-ui-html" />
<h3>Writing the HTML markup for the loading UI</h3>
<p>In the file <code>leaflet_loader.R</code>, we will define a function that creates a loading UI. This function will take the leafletOutput and wrap it in a container. The container will also have a secondary child element that contains the markup for the loading message. In this example, the function will display a text message or display loading dots. (If you have your own icon, spinner, etc., you can substitute it here.). The returned html will look like this.</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading-ui<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!--- loader ---></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!--- leaflet output ---></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>The showing of the loading element works by adding and removing a css class <code>.visually-hidden</code>. This class contains a few properties that hides the element visually by manipulating the width, height, overflow, and a few other properties of the element it is added to. This is likely better approach (performance wise) than using <code>display: none;</code> as the element isn't continuously added and removed from the document (this will be discussed in the next section).</p>
<p>Let's start with a secondary function that generates the loading message. This function will return the markup for the loading ui element based on whether or not the loader is a text message. To demonstrate a custom loader, I'm creating a series of dots that will be animated using css which will make them "blink".</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token comment"># loading screen functional component: child element</span>
loading_elem <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    stopifnot<span class="token punctuation">(</span><span class="token operator">!</span>is.null<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># generate element with dots</span>
    el <span class="token operator">&lt;-</span> tags<span class="token operator">$</span>div<span class="token punctuation">(</span>
        id <span class="token operator">=</span> id<span class="token punctuation">,</span>
        class <span class="token operator">=</span> <span class="token string">"visually-hidden loading-ui loading-dots"</span><span class="token punctuation">,</span>
        `aria<span class="token operator">-</span>hidden` <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
        tags<span class="token operator">$</span>div<span class="token punctuation">(</span>
            class <span class="token operator">=</span> <span class="token string">"dots-container"</span><span class="token punctuation">,</span>
            tags<span class="token operator">$</span>span<span class="token punctuation">(</span>class <span class="token operator">=</span> <span class="token string">"dots"</span><span class="token punctuation">,</span> id <span class="token operator">=</span> <span class="token string">"dot1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            tags<span class="token operator">$</span>span<span class="token punctuation">(</span>class <span class="token operator">=</span> <span class="token string">"dots"</span><span class="token punctuation">,</span> id <span class="token operator">=</span> <span class="token string">"dot2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            tags<span class="token operator">$</span>span<span class="token punctuation">(</span>class <span class="token operator">=</span> <span class="token string">"dots"</span><span class="token punctuation">,</span> id <span class="token operator">=</span> <span class="token string">"dot3"</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># if a message is specified, then replace dots</span>
    <span class="token comment"># and adjust classes</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>length<span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token operator">$</span>attribs<span class="token operator">$</span>class <span class="token operator">&lt;-</span> <span class="token string">"loading-ui loading-text"</span>
        el<span class="token operator">$</span>children <span class="token operator">&lt;-</span> tags<span class="token operator">$</span>p<span class="token punctuation">(</span>
            class <span class="token operator">=</span> <span class="token string">"loading-message"</span><span class="token punctuation">,</span>
            as.character<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># return</span>
    return<span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Next, let's create a parent function that returns the loading element and leaflet output. This function will call the child function and return the loader and the leaflet output in a container.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token comment">#' loader</span>
loading_message <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tags<span class="token operator">$</span>div<span class="token punctuation">(</span>
        class <span class="token operator">=</span> <span class="token string">"loading-container"</span><span class="token punctuation">,</span>
        tags<span class="token operator">$</span>span<span class="token punctuation">(</span>
            class <span class="token operator">=</span> <span class="token string">"visually-hidden"</span><span class="token punctuation">,</span>
            <span class="token string">"loading"</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        loading_elem<span class="token punctuation">(</span>id <span class="token operator">=</span> id<span class="token punctuation">,</span> text <span class="token operator">=</span> text<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token ellipsis">...</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>I've added a loading message for better accessibility support. This won't be displayed in the app nor will it interfere with the layout (I will update this element in the future after I do some more research on the best practices for loading messages).</p>
<p>When using the function, the leaflet output will be passed into the ellipses (<code>...</code>). Back in the <code>app.R</code> file, load the <code>leaflet_loader.R</code> and call the function like so:</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r"><span class="token comment"># component</span>
source<span class="token punctuation">(</span><span class="token string">"leaflet_loader.R"</span><span class="token punctuation">)</span>

<span class="token comment"># ui</span>
ui <span class="token operator">&lt;-</span> tagList<span class="token punctuation">(</span>
    tags<span class="token operator">$</span>head<span class="token punctuation">(</span>
        tags<span class="token operator">$</span>link<span class="token punctuation">(</span>
            rel <span class="token operator">=</span> <span class="token string">"stylesheet"</span><span class="token punctuation">,</span>
            href <span class="token operator">=</span> <span class="token string">"styles.css"</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span> 
    tags<span class="token operator">$</span>main<span class="token punctuation">(</span>
        tags<span class="token operator">$</span>h2<span class="token punctuation">(</span><span class="token string">"Map Output"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        tags<span class="token operator">$</span>button<span class="token punctuation">(</span>
            id <span class="token operator">=</span> <span class="token string">"plotbutton"</span><span class="token punctuation">,</span>
            class <span class="token operator">=</span> <span class="token string">"action-button shiny-bound-input"</span><span class="token punctuation">,</span>
            <span class="token string">"Add Markers"</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment"># loading ui</span>
        loading_message<span class="token punctuation">(</span>
            id <span class="token operator">=</span> <span class="token string">"leafletBusy"</span><span class="token punctuation">,</span>
            leafletOutput<span class="token punctuation">(</span><span class="token string">"map"</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>If you want to display a text-based loading UI, then pass a message using the <code>text</code> argument. You may use any ID that you like.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">loading_message<span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">"myID"</span><span class="token punctuation">,</span> text <span class="token operator">=</span> <span class="token string">"Map is Loading"</span><span class="token punctuation">,</span> leafletOutput<span class="token punctuation">(</span><span class="token string">"map"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<span id="work-ui-css" />
<h3>Styling the loading UI</h3>
<p>Now I will focus on writting the css. I won't cover everything in the css file as this post can get quite long. I will focus on the elements that will help you create your own loaders.</p>
<p>The most important part is the class that hides and shows the loading element. The class <code>.visually-hidden</code> is used to reveal the loading UI during the rendering and updating of the leaflet map. This class is the closest to hiding the loading element without removing it from the page. Modifying the display properties of an element can disrupt the document structure as elements are removed from the page. This may be very disruptive for the user. Instead, the following class reduces the size to the smallest possible size.</p>
<div class="gatsby-highlight" data-language="css"><pre class="language-css"><code class="language-css"><span class="token comment">/* class to visually hide loading screens */</span>
<span class="token selector">.visually-hidden</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">clip</span><span class="token punctuation">:</span> <span class="token function">rect</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">clip</span><span class="token punctuation">:</span> <span class="token function">rect</span><span class="token punctuation">(</span>0 0 0 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>To display the loading UI over the leaflet map, use relative positioning on the loading container. For the loading ui, I used asbolute positioning and set the z-index to an arbitrary value. This will place the loading UI on top of the leaflet output.</p>
<div class="gatsby-highlight" data-language="css"><pre class="language-css"><code class="language-css"><span class="token comment">/* styling for loading container */</span>
<span class="token selector">.loading-container</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* loading ui  */</span>
<span class="token selector">.loading-container .loading-ui</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #f6f6f6<span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">z-index</span><span class="token punctuation">:</span> 9999<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<span id="work-ui-js" />
<h3>Writing javascript to control the loading UI</h3>
<p>In this section, we will write the javascript to show/hide the loading screen during the intitial rendering of the leaflet map and when the button is clicked.</p>
<p>In early tests, I attempted to show and hide the loading element using <a href="https://shiny.rstudio.com/articles/communicating-with-js.html">custom message handlers</a>. It worked, but the results were inconsistent and it was very buggy. After searching forums for leaflet approaches and consulting the documentation, I realized that if I could "hook" into leaflet <a href="https://leafletjs.com/reference-1.6.0.html#domevent">DOMevents</a> than it would be possible to control the loader from the htmlwidget. This was not as straightfoward as I originally thought. Writing functions in a separate js file and loading it into our app isn't possible due to the structure of htmlwidgets. Using the <code>onRender</code> function in the <a href="https://cran.r-project.org/package=htmlwidgets">htmlwidgets</a>, you can pass additional js code down to the htmlwidget.</p>
<p>In the <code>renderLeaflet</code> function, we will pipe the leaflet object into the <code>onRender</code> function.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">leaflet<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%>%</span>
    addTiles<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%>%</span>
    setView<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">93.65</span><span class="token punctuation">,</span> <span class="token number">42.0285</span><span class="token punctuation">,</span> zoom <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%>%</span>
    addPopups<span class="token punctuation">(</span>
        lng <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">93.65</span><span class="token punctuation">,</span>
        lat <span class="token operator">=</span> <span class="token number">42.0285</span><span class="token punctuation">,</span>
        popup <span class="token operator">=</span> <span class="token string">"Here is the &lt;b>Department of Statistics&lt;/b>, ISU"</span>
    <span class="token punctuation">)</span> <span class="token percent-operator operator">%>%</span>
    onRender<span class="token punctuation">(</span>.<span class="token punctuation">,</span> "
        <span class="token operator">/</span><span class="token operator">/</span> js code will go here
    "<span class="token punctuation">)</span></code></pre></div>
<p>The first thing we will do, is define a new function. According to the documentation, the js code should start with <code>function(el, x)</code>. (In the following code blocks, I'll only focus on the javascript. See the <code>app.R</code> file for the complete code.)</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// inside the onRender</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> x<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span></code></pre></div>
<p>Inside the function, start off by selecting the primary elements: the leaflet map, the loading element, and the action button.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// inside the onRender</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> x<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'leafletBusy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> b <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'plotbutton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>During the initial render of the map, we want the show to loader and then hide it when the map is complete. This can be done by using the leaflet event <code>whenReady</code> and attaching it to the map element <code>m</code>. The <code>whenReady</code> event will run fairly quickly (I think this triggers when base elements are generated), so I'm using <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout">setTimeout</a> to delay the hiding of the element for 3000 milliseconds (adjust this value accordingly to fit your needs).</p>
<p>I'm using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/classList">classList</a> to <code>add</code> and <code>remove</code> the <code>.visually-hidden</code> class from the loader.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// inside the onRender</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> x<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'leafletBusy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> b <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'plotbutton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// when map is rendered, display loading</span>
    <span class="token comment">// adjust delay as needed</span>
    m<span class="token punctuation">.</span><span class="token function">whenReady</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Using this same concept, we can apply it to the button event. The structure is quite different than the ready event as we want to show the loader when the button is clicked and then hide it once all new map elements are rendered. Let's start with the basics: define an event that shows the loader as soon as the button is clicked.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// inside the onRender</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> x<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'leafletBusy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> b <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'plotbutton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// when map is rendered, display loading</span>
    <span class="token comment">// adjust delay as needed</span>
    m<span class="token punctuation">.</span><span class="token function">whenReady</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// click event</span>
    b<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// show loading element</span>
        elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The leaflet event <code>layeradd</code> is useful for running an event during an "update", but something else is needed to run additional functions when an event is completed. In this case, we will use a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a> to hide the loader once the layer is updated. Within the <code>layeradd</code> event, we will <code>resolve</code> the event after the event is finished. You can also set a delay to extend this action. Here's the basic structure for the layer event.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">m<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'layeradd'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The basic structure of a promise looks like this. (You can assign the promise to a variable and then attach other <code>then</code>-s; see previous link for further information).</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// do something</span>

    <span class="token comment">// resolve + pass data if required</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// do something on resolve</span>
    

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">// if there is an error,</span>
    <span class="token comment">// throw</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Inside the promise, we will write the <code>layeradd</code> event and add a timeout before the resolve. In the <code>then</code>, we will hide the loader. If there is an error in the promise, the <code>catch</code> will log it to the console. Here's the promise.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// leaflet event: layeradd</span>
    m<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'layeradd'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"adding element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// resolve after a few seconds to ensure all</span>
        <span class="token comment">// elements rendered (adjust as needed)</span>
        <span class="token comment">// time is in milliseconds</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// resolve: hide loading screen</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// throw errors</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Here is the entire <code>onRender</code> function.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// inside the onRender</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> x<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'leafletBusy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> b <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'plotbutton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// when map is rendered, display loading</span>
    <span class="token comment">// adjust delay as needed</span>
    m<span class="token punctuation">.</span><span class="token function">whenReady</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// click event</span>
    b<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        <span class="token comment">// show loading element</span>
        elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// promise</span>
        <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// leaflet event: layeradd</span>
            m<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'layeradd'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">// this log is for demonstration purposes only</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"adding element"</span><span class="token punctuation">)</span>

                <span class="token comment">// resolve after a few seconds to ensure all</span>
                <span class="token comment">// elements rendered (adjust as needed)</span>
                <span class="token comment">// time is in milliseconds</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// resolve: hide loading screen</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            elem<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'visually-hidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// throw errors</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>That is it! See the <code>app.R</code> file for the complete code. Take a look at the css file for all of the styles used in the app. Don't forget to adjust the timeouts as needed.</p>
<span id="know" />
<h2>What do I need to know before I integrate this into my app?</h2>
<p>This example works, but it requires a bit a hardcoding. I would recommend wrapping generating the on render script using a function. This would allow you to pass name the button ID, define the css class that hides the loading element, and to adjust delays. I will update the app when in the near future. Stay tuned!</p>
<p>Some of the timeouts are bit quick. You may want to extend them a bit to smooth out the events. You may also want to add some css <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transition">transitions</a> to smooth out the hiding/showing of the loader.</p>
<span id="run" />
<h2>How do I run the example?</h2>
<p>The code for this app can be found on Github: <a href="https://github.com/davidruvolo51/shinyAppTutorials/tree/master/leaflet-loading-screens">shinyAppTutorials/leaflet-loading-screens</a>. Alternatively, you can run the app directly from the R console.</p>
<div class="gatsby-highlight" data-language="r"><pre class="language-r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"shiny"</span><span class="token punctuation">)</span>
shiny<span class="token operator">::</span>runGithub<span class="token punctuation">(</span>repo<span class="token operator">=</span><span class="token string">"shinyAppTutorials"</span><span class="token punctuation">,</span> username<span class="token operator">=</span><span class="token string">"davidruvolo51"</span><span class="token punctuation">,</span> subdir<span class="token operator">=</span><span class="token string">"leaflet-loading-screens"</span><span class="token punctuation">)</span></code></pre></div></section><div class="article-footer"><p>Keywords</p><ul class="post-meta-tags article-tags" aria-label="post tags"><li><code class="tag tag-htmlwidgets">htmlwidgets</code></li><li><code class="tag tag-leaflet">leaflet</code></li></ul></div></article></div></div></main><footer class="footer"><h2>shinyTutorials</h2><ul class="menu footer-menu"></ul><ul class="menu footer-menu"><li class="menu-item"><a class="menu-link" href="https://www.twitter.com/dcruvolo"><svg class="icon menu-link-icon" height="30" width="30" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"></path></svg>@dcruvolo</a></li><li class="menu-item"><a class="menu-link" href="https://github.com/davidruvolo51/shinyAppTutorials"><svg class="icon menu-link-icon" height="30" width="30" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>shinyAppTutorials</a></li><li class="menu-item"><a class="menu-link" href="https://davidruvolo51.github.io/portfolio/"><svg class="icon" width="50" height="50" viewBox="0 0 50 40" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="user" transform="translate(11.280196, 6.000000)" stroke="currentColor" stroke-width="2" fill="currentColor"><path d="M27.1829506,38.463564 C27.1829506,31.1581236 23.1247009,23.3692614 18.2303544,21.0113097 C16.8720034,20.3568962 15.4135775,20 13.9041559,20 C12.4962651,20 11.1176019,20.3104979 9.81412773,20.8833092 C4.68481072,23.1373859 0.63453826,31.6314453 0.63453826,39.073266" id="body"></path><circle id="head" cx="13.7198041" cy="9" r="9"></circle></g></svg>My Portfolio</a></li></ul></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  window.excludeGAPaths=[/^(?:\/preview\/(?:(?!(?:\/|^)\.).)*?)$/,/^(?:\/do\-not\-track\/me\/too\/)$/];
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-76117337-11',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-76117337-11', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/tutorials/leaflet-loading-screens/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-861713a6e6d99061f672.js"],"component---src-components-tutorials-js":["/component---src-components-tutorials-js-d53ebef395d5c90dcd9c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-b86b6c2dbf524e19eaab.js"],"component---src-pages-about-js":["/component---src-pages-about-js-372cd01ee9c7cf021d1f.js"],"component---src-pages-gallery-index-js":["/component---src-pages-gallery-index-js-0b4caed180f04e35dc03.js"],"component---src-pages-index-js":["/component---src-pages-index-js-081bcc21e2c5112c63f8.js"],"component---src-pages-tutorials-index-js":["/component---src-pages-tutorials-index-js-c3e7453d0cfa7ddc4bf6.js"]};/*]]>*/</script><script src="/shinytutorials/component---src-components-tutorials-js-d53ebef395d5c90dcd9c.js" async=""></script><script src="/shinytutorials/ec800322c0f71b5715d75b0073f476a066af1f45-5dfcbcfd5bde2ac1f549.js" async=""></script><script src="/shinytutorials/commons-c531f5118f02e9104877.js" async=""></script><script src="/shinytutorials/styles-36681512479a843831b0.js" async=""></script><script src="/shinytutorials/app-861713a6e6d99061f672.js" async=""></script><script src="/shinytutorials/framework-e94c62ba7ecbd1156bac.js" async=""></script><script src="/shinytutorials/webpack-runtime-2f0160c733efec14b8a6.js" async=""></script></body></html>